import{r as l,u as F,j as r}from"./index-D5yokye4.js";import{F as H,f as V}from"./faHome-BbMyYVQk.js";const W=()=>{const[u,h]=l.useState([]),[f,x]=l.useState(0),[S,g]=l.useState("not over"),[d,p]=l.useState([]),[v,D]=l.useState(null),[y,I]=l.useState(null),Z=F(),M=50,j=e=>e.flat(),C=e=>j(e).includes(0),m=e=>e[0].map((t,s)=>e.map(o=>o[s])),w=e=>e.map(t=>[...t].reverse()),k=e=>JSON.parse(JSON.stringify(e)),T=e=>Array(e).fill().map(()=>Array(e).fill(0)),G=e=>{if(!C(e))return e;const t=k(e),s=[];j(t).forEach((a,U)=>{a===0&&s.push(U)});const o=s[Math.floor(Math.random()*s.length)],c=Math.floor(o/4),n=o%4;return t[c][n]=2,t},N=(e,t,s,o)=>{localStorage.setItem("2048_state",JSON.stringify({matrix:e,score:t,gameStatus:s,records:o,timestamp:Date.now()}))},A=()=>{const e=localStorage.getItem("2048_state");if(e){const{matrix:t,score:s,gameStatus:o,records:c,timestamp:n}=JSON.parse(e);if(Date.now()-n<24*60*60*1e3)return h(t),x(s),g(o),p(c),!0}return!1},E=l.useCallback(()=>{let e=T(4);e=G(G(e)),h(e),x(0),g("not over"),p([]),N(e,0,"not over",[])},[]),L=e=>{I(null),D({x:e.targetTouches[0].clientX,y:e.targetTouches[0].clientY})},O=e=>{I({x:e.targetTouches[0].clientX,y:e.targetTouches[0].clientY})},J=()=>{if(!v||!y)return;const e=v.x-y.x,t=v.y-y.y,s=Math.abs(e),o=Math.abs(t);Math.max(s,o)<M||(s>o?e>0?i("left"):i("right"):t>0?i("up"):i("down"),D(null),I(null))},Y=e=>{if(j(e).includes(2048))return"win";if(C(e))return"not over";for(let s=0;s<4;s++)for(let o=1;o<4;o++)if(e[s][o]===e[s][o-1])return"not over";const t=m(e);for(let s=0;s<4;s++)for(let o=1;o<4;o++)if(t[s][o]===t[s][o-1])return"not over";return"lose"},_=e=>e.map(t=>{const s=t.filter(o=>o!==0);return[...s,...Array(4-s.length).fill(0)]}),b=e=>{const t=k(e);let s=_(e),o=0;for(let n=0;n<4;n++)for(let a=0;a<3;a++)s[n][a]===s[n][a+1]&&s[n][a]!==0&&(s[n][a]*=2,s[n][a+1]=0,o+=s[n][a]);s=_(s);const c=JSON.stringify(t)!==JSON.stringify(s);return[s,c,o]},i=l.useCallback(e=>{let t=k(u),s=!1,o=0;switch(e){case"left":[t,s,o]=b(t);break;case"right":t=w(t),[t,s,o]=b(t),t=w(t);break;case"up":t=m(t),[t,s,o]=b(t),t=m(t);break;case"down":t=m(t),t=w(t),[t,s,o]=b(t),t=w(t),t=m(t);break}if(s){const c=[...d];c.length===3&&c.shift(),c.push({matrix:t,score:o}),t=G(t);const n=f+o,a=Y(t);h(t),x(n),p(c),g(a),N(t,n,a,c)}},[u,d,f]),X=l.useCallback(()=>{if(d.length===0)return;const e=d.slice(0,-1),t=d[d.length-1],s=f-t.score;h(t.matrix),x(s),p(e),g("not over"),N(t.matrix,s,"not over",e)},[d,f]),R=l.useCallback(e=>{if(S==="not over")switch(e.key){case"ArrowLeft":i("left");break;case"ArrowRight":i("right");break;case"ArrowUp":i("up");break;case"ArrowDown":i("down");break}},[S,i]);l.useEffect(()=>(u.length===0&&(A()||E()),window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)),[R,E,u.length]);const z=e=>({0:"#eee",2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",64:"#f65e3b",128:"#edcf72",256:"#edcc61",512:"#edc850",1024:"#edc53f",2048:"#edc22e"})[e]||"#edc22e";return r.jsxs("div",{className:"flex flex-col items-center p-4",children:[r.jsxs("div",{className:"relative flex justify-center items-center w-full my-8",children:[r.jsx("h1",{className:"text-4xl font-bold",children:"2048"}),r.jsx("nav",{className:"absolute right-2 text-2xl",children:r.jsx("a",{className:"navLink",onClick:()=>Z("/tools"),children:r.jsx(H,{icon:V.faHome,style:{fontSize:"30px"}})})})]}),r.jsxs("div",{className:"mb-4 flex flex-center justify-between w-full",children:[r.jsxs("div",{className:"text-xl font-bold pr-3",children:["Score: ",f]}),r.jsxs("div",{className:"space-x-2",children:[r.jsx("button",{className:"button-89 my-2 sm:my-5 ml-0",onClick:E,children:"New Game"}),r.jsx("button",{className:"button-89 my-2 sm:my-5 ml-0",onClick:X,disabled:d.length===0,children:"Undo"})]})]}),r.jsx("div",{className:"bg-gray-300 p-4 rounded-lg touch-none",onTouchStart:L,onTouchMove:O,onTouchEnd:J,children:r.jsx("div",{className:"grid grid-cols-4 gap-2",children:u.map((e,t)=>e.map((s,o)=>r.jsx("div",{style:{backgroundColor:z(s),height:"64px",width:"64px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"1.5rem",borderRadius:"0.5rem",transition:"background-color 0.15s ease-in-out",color:"black"},children:s!==0?s:""},`${t}-${o}`)))})}),S!=="not over"&&r.jsx("div",{className:"mt-4 text-xl font-bold",children:S==="win"?"Congratulations! You won!":"Game Over!"})]})};export{W as default};
